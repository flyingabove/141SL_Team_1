newdata$col9 <- cumsum(newdata$col8)
data <- data.frame(alpha, beta, Ribar, mse)
rf <- 0.001
data$col5 <- (Ribar - rf) / beta
newdata <- data[order(-data$col5), ]
newdata$col6 <- ((newdata$Ribar - rf)*newdata$beta) / newdata$mse
newdata$col7 <- cumsum(newdata$col6)
newdata$col8 <- beta^2 / mse
newdata$col9 <- cumsum(newdata$col8)
View(newdata)
newdata$col8 <- newdata$beta^2 / newdata$mse
newdata$col9 <- cumsum(newdata$col8)
View(newdata)
c_shortsales <- (var(returns[, 11])*sum(newdata$col6)) / (1 + var(returns[, 11])*sum(newdata$col8))
c_shortsales
c_noshortsales <- (var(returns[, 11])*newdata$col7) / (1 + var(returns[, 11])*newdata$col9)
c_noshortsales
c_noshortsales <- max((var(returns[, 11])*newdata$col7) / (1 + var(returns[, 11])*newdata$col9))
c_noshortsales
z <- (newdata$beta / newdata$mse)*(col5 - c_noshortsales)
z
x <- z / sum(z)
x
z <- (newdata$beta / newdata$mse)*(newdata$col5 - c_noshortsales)
x <- z / sum(z)
x
newdata$col5
newdata$beta
newdata$mse
newdata$col5
1.1269555/0.017827338
0.0153679818-c_noshortsales
63.21502*0.01225488
z <- (newdata$beta / newdata$mse)*(newdata$col5 - c_noshortsales)
z
newdata2 <- newdata
View(newdata2)
newdata2$c <- (var(returns[, 11])*newdata$col7) / (1 + var(returns[, 11])*newdata$col9)
max(newdata2$c)
newdata2 <- newdata2[newdata2$c > max(newdata2$c), ]
View(newdata2)
newdata2$c
newdata2 <- newdata
newdata2 <- newdata2[newdata2$c > max(newdata2$c), ]
newdata2$c <- (var(returns[, 11])*newdata$col7) / (1 + var(returns[, 11])*newdata$col9)
newdata2 <- newdata
View(newdata)
newdata2$c <- (var(returns[, 11])*newdata2$col7) / (1 + var(returns[, 11])*newdata2$col9)
max(newdata2$c)
newdata2$c > max(newdata2$c)
View(newdata2)
newdata2$c <= max(newdata2$c)
newdata2$c
which(newdata2$c == max(newdata2$c))
newdata2 <- newdata2[1:which(newdata2$c == max(newdata2$c)), ]
View(newdata2)
z <- (newdata2$beta / newdata2$mse)*(newdata2$col5 - c_noshortsales)
z
x <- z / sum(z)
x
z <- (newdata$beta / newdata$mse)*(newdata$col5 - c_shortsales)
x <- z / sum(z)
x
var1[1]
sqrt(var1[1])
(Ribar[1] - rf) / sqrt(var1[1])
data2 <- data.frame(Ribar)
rf <- 0.001
data2$ratio <- (Ribar - rf) / var1^0.5
newdata2 <- data2[order(-data$ratio), ]
newdata2 <- data2[order(-data2$ratio), ]
View(newdata2)
data2 <- data.frame(Ribar, var1)
rf <- 0.001
data2$ratio <- (Ribar - rf) / var1^0.5
newdata2 <- data2[order(-data2$ratio), ]
View(newdata2)
cor(returns)
cor(returns[, -11])
sum(cor(returns[, -11]) - 10)/90
sum(cor(returns[, -11]))
(sum(cor(returns[, -11]))-10)/90
var(returns)
v <- var(returns[, -11])
v
diag(v)
data2 <- data.frame(Ribar, var = diag(v))
rf <- 0.001
data2$ratio <- (Ribar - rf) / var1^0.5
newdata2 <- data2[order(-data2$ratio), ]
View(newdata2)
data2 <- data.frame(Ribar, var = diag(v))
rf <- 0.001
data2$ratio <- (data2$Ribar - rf) / data2$var^0.5
newdata2 <- data2[order(-data2$ratio), ]
View(newdata2)
View(newdata2)
cumsum(1:10)
1:10
rep(1, 10)
cumsum(rep(1, 10))
(1:10)*avg_rho
(1:10)*avg_cor
avg_cor <- (sum(cor(returns[, -11])) - 10) / 90
(1:10)*avg_cor
avg_cor
avg_cor / (1 - avg_cor + (1:10)*avg_cor)
data2 <- data.frame(Ribar, var = diag(v))
rf <- 0.001
data2$ratio <- (data2$Ribar - rf) / data2$var^0.5
newdata2 <- data2[order(-data2$ratio), ]
newdata2$col4 <- avg_cor / (1 - avg_cor + (1:10)*avg_cor)
newdata2$col5 <- cumsum(newdata2$ratio)
View(newdata2)
c_shortsales_ccm <- (avg_cor / (1 - avg_cor + 10*avg_cor))*sum(newdata2$ratio)
c_shortsales_ccm
newdata3 <- newdata2
newdata3$c <- (avg_cor / (1 - avg_cor + (1:10)*avg_cor))*sum(newdata3$ratio)
View(newdata3)
newdata3 <- newdata3[1:which(newdata3$c == max(newdata3$c)), ]
View(newdata3)
newdata3 <- newdata2
newdata3$c <- (avg_cor / (1 - avg_cor + (1:10)*avg_cor))*sum(newdata3$ratio)
newdata3$c
newdata3 <- newdata2
newdata3$c <- (avg_cor / (1 - avg_cor + (1:10)*avg_cor))*cumsum(newdata3$ratio)
newdata3 <- newdata3[1:which(newdata3$c == max(newdata3$c)), ]
View(newdata3)
max(newdata3$c)
newdata3 <- newdata2
newdata3$c <- (avg_cor / (1 - avg_cor + (1:10)*avg_cor))*col5
newdata3 <- newdata3[1:which(newdata3$c == max(newdata3$c)), ]
c_noshortsales_ccm <- max(newdata3$c)
c_noshortsales_ccm
newdata3 <- newdata2
newdata3$c <- (avg_cor / (1 - avg_cor + (1:10)*avg_cor))*cumsum(newdata3$ratio)
newdata3 <- newdata3[1:which(newdata3$c == max(newdata3$c)), ]
c_noshortsales_ccm <- max(newdata3$c)
c_noshortsales_ccm
z <- (1 / (1 - avg_cor)*newdata2$var)*(newdata$ratio - c_shortsales_ccm)
x <- z / sum(z)
x
z <- (1 / (1 - avg_cor)*newdata2$var)*(newdata2$ratio - c_shortsales_ccm)
x <- z / sum(z)
x
newdata2$var
newdata2$ratio
z <- (1 / (1 - avg_cor)*newdata2$var^0.5)*(newdata2$ratio - c_shortsales_ccm)
x <- z / sum(z)
x
View(newdata2)
(1 / (1 - avg_cor)*newdata2$var[1]^0.5)
newdata2$ratio - c_shortsales_ccm
newdata2$ratio[1] - c_shortsales_ccm
0.1809775*0.09930765
(1-avg_cor)
0.7899433*newdata2$var[1]^0.5
1/0.1129318
8.854902*0.09930765
z <- (1 / ((1 - avg_cor)*newdata2$var[1]^0.5))*(newdata2$ratio - c_shortsales_ccm)
x <- z / sum(z)
x
z
z <- (1 / ((1 - avg_cor)*newdata2$var^0.5))*(newdata2$ratio - c_shortsales_ccm)
x <- z / sum(z)
x
View(newdata3)
z <- (1 / ((1 - avg_cor)*newdata3$var^0.5))*(newdata3$ratio - c_noshortsales_ccm)
x <- z / sum(z)
x
z
View(newdata3)
data <- data.frame(alpha, beta, Ribar, mse)
rf <- 0.001
data$col5 <- (data$Ribar - rf) / data$beta
newdata <- data[order(-data$col5), ]
newdata$col6 <- ((newdata$Ribar - rf)*newdata$beta) / newdata$mse
newdata$col7 <- cumsum(newdata$col6)
newdata$col8 <- newdata$beta^2 / newdata$mse
newdata$col9 <- cumsum(newdata$col8)
c_shortsales <- (var(returns[, 11])*sum(newdata$col6)) / (1 + var(returns[, 11])*sum(newdata$col8))
c_shortsales
newdata2 <- newdata
newdata2$c <- (var(returns[, 11])*newdata2$col7) / (1 + var(returns[, 11])*newdata2$col9)
c_noshortsales <- max(newdata2$c)
c_noshortsales
newdata2 <- newdata2[1:which(newdata2$c == max(newdata2$c)), ]
newdata2
z <- (newdata2$beta / newdata2$mse)*(newdata2$col5 - c_noshortsales)
x <- z / sum(z)
x
z <- (newdata$beta / newdata$mse)*(newdata$col5 - c_shortsales)
x <- z / sum(z)
x
avg_cor <- (sum(cor(returns[, -11])) - 10) / 90
v <- var(returns[, -11])
data2 <- data.frame(Ribar, var = diag(v))
rf <- 0.001
data2$ratio <- (data2$Ribar - rf) / data2$var^0.5
newdata2 <- data2[order(-data2$ratio), ]
newdata2$col4 <- avg_cor / (1 - avg_cor + (1:10)*avg_cor)
newdata2$col5 <- cumsum(newdata2$ratio)
c_shortsales_ccm <- (avg_cor / (1 - avg_cor + 10*avg_cor))*sum(newdata2$ratio)
c_shortsales_ccm
newdata2
newdata3 <- newdata2
newdata3$c <- (avg_cor / (1 - avg_cor + (1:10)*avg_cor))*cumsum(newdata3$ratio)
newdata3 <- newdata3[1:which(newdata3$c == max(newdata3$c)), ]
c_noshortsales_ccm <- max(newdata3$c)
c_noshortsales_ccm
newdata3
## short sales allowed ##
z <- (1 / ((1 - avg_cor)*newdata2$var^0.5))*(newdata2$ratio - c_shortsales_ccm)
x <- z / sum(z)
x
z <- (1 / ((1 - avg_cor)*newdata3$var^0.5))*(newdata3$ratio - c_noshortsales_ccm)
x <- z / sum(z)
x
data <- data.frame(alpha, beta, Ribar, mse, beta_adj)
rf <- 0.001
data$col5 <- (data$Ribar - rf) / data$beta
newdata <- data[order(-data$col5), ]
newdata$col6 <- ((newdata$Ribar - rf)*newdata$beta) / newdata$mse
newdata$col7 <- cumsum(newdata$col6)
newdata$col8 <- newdata$beta^2 / newdata$mse
newdata$col9 <- cumsum(newdata$col8)
newdata
c_shortsales <- (var(returns[, 11])*sum(newdata$col6)) / (1 + var(returns[, 11])*sum(newdata$col8))
c_shortsales
data$col5 <- (data$Ribar - rf) / data$beta_adj
newdata <- data[order(-data$col5), ]
newdata$col6 <- ((newdata$Ribar - rf)*newdata$beta) / newdata$mse
newdata$col7 <- cumsum(newdata$col6)
data$col5 <- (data$Ribar - rf) / data$beta_adj
newdata <- data[order(-data$col5), ]
newdata$col6 <- ((newdata$Ribar - rf)*newdata$beta_adj) / newdata$mse
newdata$col7 <- cumsum(newdata$col6)
newdata$col8 <- newdata$beta_adj^2 / newdata$mse
newdata$col9 <- cumsum(newdata$col8)
newdata
c_shortsales <- (var(returns[, 11])*sum(newdata$col6)) / (1 + var(returns[, 11])*sum(newdata$col8))
c_shortsales
newdata2 <- newdata
newdata2$c <- (var(returns[, 11])*newdata2$col7) / (1 + var(returns[, 11])*newdata2$col9)
c_noshortsales <- max(newdata2$c)
c_noshortsales
newdata2 <- newdata2[1:which(newdata2$c == max(newdata2$c)), ]
newdata2
z <- (newdata2$beta_adj / newdata2$mse)*(newdata2$col5 - c_noshortsales_adj)
c_shortsales_adj <- (var(returns[, 11])*sum(newdata$col6)) / (1 + var(returns[, 11])*sum(newdata$col8))
c_shortsales_adj
z <- (newdata2$beta_adj / newdata2$mse)*(newdata2$col5 - c_noshortsales_adj)
c_noshortsales_adj <- max(newdata2$c)
c_noshortsales_adj
z <- (newdata2$beta_adj / newdata2$mse)*(newdata2$col5 - c_noshortsales_adj)
x <- z / sum(z)
x
c_noshortsales_adj
newdata2
data$col5 <- (data$Ribar - rf) / data$beta_adj
newdata <- data[order(-data$col5), ]
newdata$col6 <- ((newdata$Ribar - rf)*newdata$beta_adj) / newdata$mse
newdata$col7 <- cumsum(newdata$col6)
newdata$col8 <- newdata$beta_adj^2 / newdata$mse
newdata
newdata$col9 <- cumsum(newdata$col8)
c_shortsales_adj <- (var(returns[, 11])*sum(newdata$col6)) / (1 + var(returns[, 11])*sum(newdata$col8))
c_shortsales_adj
newdata2 <- newdata
newdata2$c <- (var(returns[, 11])*newdata2$col7) / (1 + var(returns[, 11])*newdata2$col9)
c_noshortsales_adj <- max(newdata2$c)
c_noshortsales_adj
newdata2 <- newdata2[1:which(newdata2$c == max(newdata2$c)), ]
newdata2
## short sales not allowed (adjusted beta) ##
z <- (newdata2$beta_adj / newdata2$mse)*(newdata2$col5 - c_noshortsales_adj)
x <- z / sum(z)
x
z
z <- (newdata$beta_adj / newdata$mse)*(newdata$col5 - c_shortsales_adj)
x <- z / sum(z)
x
beta_adj
newdata$col5
32+22.5+28
82.5+30.5+26+27.5+25+28+31+27.5+27+29.5+28+26.5+30+28.6+25.2+29.2
502/18
32+30.5+25+27.5+28+28.6+30.1+28.9+30.9+34.4+32.7+32.7
361.3+502
863.3/30
?as.short
?as.double
?array
min_pitch <- 40
max_pitch <- 720
frame_size <- 480
valid_corr <- 0.7
buffer <- array(max_pitch + frame_size)
buffer
buffer <- array(0, max_pitch + frame_size)
buffer
min_pitch <- 40
max_pitch <- 720
frame_size <- 480
valid_corr <- 0.7
short <- function(signal, frame_size) {
buffer <- array(0, max_pitch + frame_size)
correlation_sm <- array(0, max_pitch + 1)
first_flag <- 1
if(first_flag) {
for(i in 1:(max_pitch + frame_size)) {
buffer[i] <- 1
}
for(i in 1:(max_pitch + 1)) {
correlation_sm[i] <- 0
}
first_flag <- 0
}
for(i in 1:max_pitch) {
buffer[i] <- buffer[i + frame_size]
}
for(i in 1:frame_size) {
buffer[i + max_pitch] <- signal[i]
}
max_corr <- 0
for(i in min_pitch:max_pitch) {
ptr1 <- buffer + max_pitch
ptr2 <- ptr1 - i
correlation <- 0
energy1 <- 0
energy2 <- 0
for(j in 1:frame_size) {
correlation <- correlation + ptr1[j]*ptr2[j]
energy1 <- energy1 + ptr1[j]*ptr2[j]
energy2 <- energy2 + ptr1[j]*ptr2[j]
}
correlation <- correlation / (sqrt(energy1 * energy2 + 0.000001))
if(correlation > max_corr) {
max_corr <- correlation
}
if(correlation > valid_corr) {
correlation_sm[i] <- 0.95*correlation_sm[i] + 0.05*correlation
}
}
max_v <- -1
pitch_value <- 0
for(i in min_pitch:max_pitch) {
if(correlation_sm[i] > max) {
pitch_value <- i
max_v <- correlation_sm[i]
}
}
if(max_corr > valid_corr && max_v > (valid_corr-0.3)) {
return(pitch_value)
}
else
return(0)
}
library(tuneR)
s10<-readWave("Baby_cry01.wav")
head(s10@left)
s10
s10@left
short(head(s10@left), 10)
min_pitch <- 40
max_pitch <- 720
frame_size <- 480
valid_corr <- 0.7
signal <- 50
frame_size = 10
max_pitch = 50
buffer <- array(0, max_pitch + frame_size)
buffer
correlation_sm <- array(0, max_pitch + 1)
correlation_sm
first_flag <- 1
if(first_flag) {
for(i in 1:(max_pitch + frame_size)) {
buffer[i] <- 1
}
for(i in 1:(max_pitch + 1)) {
correlation_sm[i] <- 0
}
first_flag <- 0
}
correlation_sm
buffer
for(i in 1:max_pitch) {
buffer[i] <- buffer[i + frame_size]
}
buffer
max_pitch
for(i in 1:frame_size) {
buffer[i + max_pitch] <- signal[i]
}
buffer
signal
max_corr <- 0
for(i in min_pitch:max_pitch) {
ptr1 <- buffer + max_pitch
ptr2 <- ptr1 - i
correlation <- 0
energy1 <- 0
energy2 <- 0
for(j in 1:frame_size) {
correlation <- correlation + ptr1[j]*ptr2[j]
energy1 <- energy1 + ptr1[j]*ptr2[j]
energy2 <- energy2 + ptr1[j]*ptr2[j]
}
correlation <- correlation / (sqrt(energy1 * energy2 + 0.000001))
if(correlation > max_corr) {
max_corr <- correlation
}
if(correlation > valid_corr) {
correlation_sm[i] <- 0.95*correlation_sm[i] + 0.05*correlation
}
}
correlation_sm
energy1
max_v <- -1
pitch_value <- 0
for(i in min_pitch:max_pitch) {
if(correlation_sm[i] > max) {
pitch_value <- i
max_v <- correlation_sm[i]
}
}
max_v <- -1
pitch_value <- 0
for(i in min_pitch:max_pitch) {
if(correlation_sm[i] > max_v) {
pitch_value <- i
max_v <- correlation_sm[i]
}
}
if(max_corr > valid_corr && max_v > (valid_corr-0.3)) {
return(pitch_value)
}
else
else {
return(0)
}
else {
return(0)
}
pitch_value
min_pitch
max_v
min_pitch <- 40
max_pitch <- 720
frame_size <- 480
valid_corr <- 0.7
short <- function(signal, frame_size) {
buffer <- array(0, max_pitch + frame_size)
correlation_sm <- array(0, max_pitch + 1)
first_flag <- 1
if(first_flag) {
for(i in 1:(max_pitch + frame_size)) {
buffer[i] <- 1
}
for(i in 1:(max_pitch + 1)) {
correlation_sm[i] <- 0
}
first_flag <- 0
}
for(i in 1:max_pitch) {
buffer[i] <- buffer[i + frame_size]
}
for(i in 1:frame_size) {
buffer[i + max_pitch] <- signal[i]
}
max_corr <- 0
for(i in min_pitch:max_pitch) {
ptr1 <- buffer + max_pitch
ptr2 <- ptr1 - i
correlation <- 0
energy1 <- 0
energy2 <- 0
for(j in 1:frame_size) {
correlation <- correlation + ptr1[j]*ptr2[j]
energy1 <- energy1 + ptr1[j]*ptr2[j]
energy2 <- energy2 + ptr1[j]*ptr2[j]
}
correlation <- correlation / (sqrt(energy1 * energy2 + 0.000001))
if(correlation > max_corr) {
max_corr <- correlation
}
if(correlation > valid_corr) {
correlation_sm[i] <- 0.95*correlation_sm[i] + 0.05*correlation
}
}
max_v <- -1
pitch_value <- 0
for(i in min_pitch:max_pitch) {
if(correlation_sm[i] > max_v) {
pitch_value <- i
max_v <- correlation_sm[i]
}
}
if(max_corr > valid_corr && max_v > (valid_corr-0.3)) {
return(pitch_value)
}
}
library(tuneR)
s10<-readWave("Baby_cry01.wav")
head(s10@left)
short(head(s10@left))
short(head(s10@left), 10)
a <- short(head(s10@left), 10)
a
a <- short(s10@left[500], 10)
a
